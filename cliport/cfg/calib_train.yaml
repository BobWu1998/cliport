# Training

defaults:
  - config

hydra:
  run:
    dir: ${train.train_dir}

dataset:
  type: 'single' # 'single' or 'multi'
  images: True
  cache: True # load episodes to memory instead of reading from disk
  augment:
    theta_sigma: 60 # rotation sigma in degrees; N(mu = 0, sigma = theta_sigma).

train:
  # folders
  exp_folder: exps 
  train_dir: ${root_dir}/${train.exp_folder}/multi-language-conditioned-${train.agent}-n${train.n_demos}-calib # 'multi-language-conditioned'
  

  data_dir: ${root_dir}/data

  # task configs
  task: packing-boxes-pairs-seen-colors
  agent: two_stream_full_clip_lingunet_lat_transporter
  n_demos: 1000
  n_steps: 201000 # use 601000 for multi-task models

  # hyper params
  n_rotations: 36
  batchnorm: False # important: False because batch_size=1
  lr: 1e-4

  attn_stream_fusion_type: 'add'
  trans_stream_fusion_type: 'conv'
  lang_fusion_type: 'mult'

  # script configs
  gpu: [0] # -1 for all
  log: False # log metrics and stats to wandb
  n_val: 100
  val_repeats: 1
  save_steps: [1000, 2000, 3000, 4000, 5000, 7000, 10000, 20000, 40000, 80000, 120000, 160000, 200000, 300000, 400000, 500000, 600000, 800000, 1000000, 1200000]
  load_from_last_ckpt: True

wandb:
  run_name: 'cliport0'
  logger:
    entity: cliport
    project: cliport
    tags: []
    group: train
    offline: False
  saver:
    upload: False
    monitor: 'calib/loss' #'val_loss'

calibration:
  enabled: True
  datasets_type: 'single'
  training: True
  calib_type: temperature
  training_iter: 1000
  calib_attn_lr: 0.1
  calib_trans_lr: 0.1
  use_hard_temp: False
  hard_temp: 1
  scaling_in_eval: True
  
  n_demos: 100
  n_steps: 20000 #100 #1000 #201000 # use 601000 for multi-task models
  
  # save_steps should be smaller than n_steps
  save_steps: [100, 1000, 2000, 3000, 4000, 5000, 7000, 10000]
  
  scaler_log_name: ${train.task}-${train.agent}-n${train.n_demos}-calib
  scaler_log_root:  ${root_dir}/shared/${train.exp_folder}/${calibration.scaler_log_name}


action_selection:
  enabled: False
  attn_uaa: False
  trans_uaa: False
  attn_tau: 5
  trans_tau: 5